# little-car

智能小车

## 项目简介

这是一个基于STM32F103C8T6微控制器和Embassy-rs异步框架开发的智能小车项目。小车具有以下功能：

1. 蓝牙遥控模式：通过蓝牙模块接收指令控制小车行驶
2. 超声波避障模式：利用超声波传感器自动检测障碍物并避开
3. 舵机控制：可以控制舵机旋转角度，用于超声波传感器的方向控制
4. LED指示灯：用于显示小车当前状态

## 硬件组成

小车使用的主控制器为STM32F103C8T6，搭配L298N电机驱动模块、HC-SR04超声波模块、SG90舵机以及蓝牙模块等外设。

## 引脚连接

| 元器件 | STM32引脚 | 功能描述 |
| ------ | -------- | ------- |
| **电机驱动** |  |  |
| 电机A PWM | PA1 (TIM2_CH2) | 左电机速度控制 |
| AIN1 | PB0 | 左电机方向控制1 |
| AIN2 | PB1 | 左电机方向控制2 |
| 电机B PWM | PA2 (TIM2_CH3) | 右电机速度控制 |
| BIN1 | PB10 | 右电机方向控制1 |
| BIN2 | PB11 | 右电机方向控制2 |
| **超声波** |  |  |
| TRIG | PA4 | 超声波发送触发信号 |
| ECHO | PA3 (EXTI3) | 超声波接收回波信号 |
| **舵机** |  |  |
| 控制信号 | PA11 (TIM1_CH4) | 控制舵机旋转角度 |
| **蓝牙模块** |  |  |
| RX | PA10 (USART1_RX) | 接收蓝牙指令 |
| **状态指示** |  |  |
| LED | PC13 | 状态指示灯 |

## 控制模式

### 蓝牙控制模式

通过蓝牙模块发送的指令控制小车的运动方向和速度，支持的指令包括：

- 停止(0x30)
- 前进(0x31)
- 右前(0x32)
- 右转(0x33)
- 右后(0x34)
- 后退(0x35)
- 左后(0x36)
- 左转(0x37)
- 左前(0x38)
- 设置速度(0x50-0x59)：对应50%-95%的速度
- 切换到自动避障模式(0x40)
- 切换到蓝牙控制模式(0x41)

### 超声波自动避障模式

小车使用超声波传感器检测前方障碍物，当探测到前方障碍物时（距离小于10厘米）：

1. 停止前进
2. 舵机转向0度（右侧）测量距离
3. 如右侧有足够空间，则向右转弯并继续前进
4. 如右侧空间不足，舵机转向180度（左侧）测量距离
5. 如左侧有足够空间，则向左转弯并继续前进
6. 如左右两侧都无足够空间，判断为死胡同，切换到蓝牙控制模式

## 软件架构

项目使用Rust语言和Embassy异步框架开发，主要模块包括：

- 电机控制(car.rs)
- 蓝牙通信(bluetooth.rs)
- 超声波测距(ultrasound.rs)
- 舵机控制(servo.rs)
- 状态指示(idle.rs)
- 控制逻辑(control.rs)

## 构建与烧录

项目使用Cargo构建，通过probe-rs工具烧录到STM32芯片：

```bash
cargo build
cargo run
```

## 许可证

MulanPSL-2.0
